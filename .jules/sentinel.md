## 2024-05-23 - Stored XSS in RSS Feed Generation
**Vulnerability:** The RSS feed generator (`src/build_feed.py`) was taking plain text descriptions (generated by `html_to_text`) and wrapping them in `CDATA` blocks for the `content:encoded` element without escaping. Since `html_to_text` unescapes HTML entities (e.g., `&lt;script&gt;` becomes `<script>`), malicious input could be rendered as executable HTML/JavaScript by RSS readers.
**Learning:** `html_to_text` produces "text" for human consumption, but "text" containing `<` and `>` characters is dangerous when placed into an HTML context (like `content:encoded` in RSS) even if wrapped in `CDATA`. `CDATA` only protects the XML parser, not the downstream HTML renderer.
**Prevention:** Always use `html.escape()` on text content before placing it into `content:encoded` or similar HTML-capable fields in RSS feeds, even if the content is nominally "plain text" and even if using `CDATA`.

## 2024-05-24 - Unvalidated URL Configuration via Environment Variables
**Vulnerability:** The application allowed configuring external provider URLs (e.g., `WL_RSS_URL`) via environment variables without validation. This could potentially enable SSRF (Server-Side Request Forgery) attacks or local file access if a malicious user could control the environment (e.g., setting `WL_RSS_URL=file:///etc/passwd`).
**Learning:** Even "internal" configuration variables should be treated as untrusted input if they control network requests. Relying on implicit trust for environment variables is risky in environments where they might be injected or misconfigured.
**Prevention:** Explicitly validate all user-configurable URLs using a strict allowlist of schemes (e.g., `http`, `https`). Implemented `validate_http_url` in `src/utils/http.py` and applied it to all provider configurations.

## 2024-12-25 - Insecure Temporary File Creation
**Vulnerability:** The feed builder (`src/build_feed.py`) was creating temporary files using `out_path.with_suffix('.tmp')` before atomically replacing the target file. This predictable filename pattern (e.g., `feed.tmp` for `feed.xml`) in a shared directory (`/tmp` or similar) is vulnerable to symlink attacks or race conditions (CWE-377), where an attacker could pre-create the file or a link to a sensitive file.
**Learning:** Predictable temporary filenames are a security risk, even in build scripts. Additionally, `tempfile.mkstemp` is secure but creates files with restrictive permissions (`0o600`), which breaks functionality for public artifacts like RSS feeds that need to be world-readable (`0o644`).
**Prevention:** Always use `tempfile.mkstemp` (or `NamedTemporaryFile` with `delete=False`) for creating temporary files to ensure uniqueness and security. When the file is intended for public consumption, explicitly set permissions (e.g., `os.chmod(path, 0o644)`) before moving it into place.
